function check1(){checked=$("code1").value.split(/\r?\n/),lines=checked.length,currline=0,userv={},callstack=[],callpointer=0,datastack=[],datapointer=0,$("code2").value=getdebug(),clear3(),luamode=!1}function step2(){function n(n,e,a,l){var c=2;do e++,c++;while("="===n[e]);return"["===n[e]?luaDelimiter=c:e=l?a:e-1,e}var e,a,l="",c=0;if(tmpline=currline,luamode){for(e=checked[tmpline++],luaEscaping=!1,a=e.length;a>c;c++)switch(luaDelimiter){case 0:switch(e[c]){case"'":luaDelimiter=1;break;case'"':luaDelimiter=2;break;case"-":"-"===e[++c]&&(c="["!==e[++c]?a:n(e,c,a,1));break;case"[":c=n(e,c,null,0)}break;case 1:case 2:luaEscaping?luaEscaping=0:"\\"===e[c]?luaEscaping=1:(1===luaDelimiter?"'":'"')&&(luaDelimiter=0);break;default:luaEscaping?"="===e[c]?luaEscaping++:"]"===e[c]&&(luaEscaping===luaDelimiter&&(luaDelimiter=0),luaEscaping=0):"]"===e[c]&&(luaEscaping=3)}luaDelimiter||!e.match(/^\s*luaEnd\s*\(\s*\)\s*(;\s*)?$/)?luacode+=e+"\n":(luamode=!1,LuaScript2.loadString(luacode)(),luacode=null)}else{do e=checked[tmpline++],l+=e+"\n";while(e.match(/\\*$/)[0].length%2===1);myEval(l)}currline=tmpline,$("code2").value=getdebug()}function auto2(){step2(),interval&&requestAnimationFrame(auto2)}function clear3(){$("code3").value=""}function getdebug(){for(var n="",e=0;lines>e;e++)n+=(currline===e?"> ":"  ")+checked[e]+"\n";return n}var checked,lines,currline,tmpline,interval=!1,callstack,callpointer,datastack,datapointer,luacode,luamode,luaDelimiter=0,luaEscaping=0,LuaScript2=luajs.newContext();LuaScript2.loadStdLib(),LuaScript2._G.stringMap.io.stringMap.write=function(n){$("code3").value+=n},LuaScript2._G.stringMap.parentEval=function(n){return myEval(n)},!function(n){n.Vnprint=function(n){$("code3").value+=n},n.Vnprint.fquote=!1,n.Vnprint._cook=-1,n.Vnclear=function(n){$("code3").value=""},n.Vnclear.fquote=!1,n.Vnclear._cook=-1,n.Vniif=function(n,e,a){return n?e:a},n.Vniif.fquote=!1,n.Vniif._cook=-1,n.Vnjump=function(n){tmpline=currline+n},n.Vnjump.fquote=!1,n.Vnjump._cook=-1,n.Vnjumpcond=function(n,e){e&&(tmpline=currline+n)},n.Vnjumpcond.fquote=!1,n.Vnjumpcond._cook=-1,n.Vnabsjump=function(n){tmpline=n},n.Vnabsjump.fquote=!1,n.Vnabsjump._cook=-1,n.Vnabsjumpcond=function(n,e){e&&(tmpline=n)},n.Vnabsjumpcond.fquote=!1,n.Vnabsjumpcond._cook=-1,n.Vnpause=function(n,e){interval=!1},n.Vnpause.fquote=!1,n.Vnpause._cook=-1,n.Vncall=function(n){callstack[callpointer++]=tmpline,tmpline=currline+n},n.Vncall.fquote=!1,n.Vncall._cook=-1,n.Vncallcond=function(n,e){e&&(callstack[callpointer++]=tmpline,tmpline=currline+n)},n.Vncallcond.fquote=!1,n.Vncallcond._cook=-1,n.Vnabscall=function(n){callstack[callpointer++]=tmpline,tmpline=n},n.Vnabscall.fquote=!1,n.Vnabscall._cook=-1,n.Vnabscallcond=function(n,e){e&&(callstack[callpointer++]=tmpline,tmpline=n)},n.Vnabscallcond.fquote=!1,n.Vnabscallcond._cook=-1,n.Vnmodline=function(n,e){var a=currline+ +n;if(lines>=a){for(var l=lines;a>l;l++)checked[l]="";lines++}checked[a]=""+e},n.Vnmodline.fquote=!1,n.Vnmodline._cook=-1,n.Vnabsmodline=function(n,e){if(lines>=n){for(var a=lines;n>a;a++)checked[a]="";lines++}checked[n]=""+e},n.Vnabsmodline.fquote=!1,n.Vnabsmodline._cook=-1,n.Vnret=n.Vnreturn=function(){tmpline=callstack[--callpointer]},n.Vnret.fquote=!1,n.Vnret._cook=-1,n.Vnmod=n.Vnmodulo=function(n,e){return n%e},n.Vnmod.fquote=!1,n.Vnmod._cook=-1,n.Vnassign=function(n,e){userv["Vn"+n]=e},n.Vnassign.fquote=!1,n.Vnassign._cook=-1,n.Vnpush=function(){for(var n=0,e=arguments.length;e>n;++n)datastack[datapointer++]=userv[arguments[n]]},n.Vnpush.fquote=!1,n.Vnpush._cook=-1,n.Vnpop=function(){for(var n=0,e=arguments.length;e>n;++n)userv[arguments[n]]=datastack[--datapointer]},n.Vnpop.fquote=!1,n.Vnpop._cook=-1,n.VnevalLua=function(n){LuaScript2.loadString(n)()},n.VnevalLua.fquote=!1,n.VnevalLua._cook=-1,n.VnluaBegin=function(){luacode="",luamode=!0},n.VnluaBegin.fquote=!1,n.VnluaBegin._cook=-1}(vtable);
